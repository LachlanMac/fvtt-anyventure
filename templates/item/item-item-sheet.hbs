<form class="{{cssClass}} {{item.type}} flexcol" autocomplete="off">

  {{!-- Sheet Header --}}
  {{> "systems/anyventure/templates/partials/items/item-header.hbs"}}

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item active" data-tab="basic">Basic</a>
    {{#if (eq system.itemType "weapon")}}
      <a class="item" data-tab="weapon">Weapon</a>
    {{/if}}
    {{#if (eq system.itemType "implant")}}
      <a class="item" data-tab="implant">Implant</a>
    {{/if}}
    <a class="item" data-tab="bonuses">Bonuses</a>
    <a class="item" data-tab="mitigation">Mitigation</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Basic Tab --}}
    <div class="tab active" data-group="primary" data-tab="basic">
      <div class="item-basic-grid">

        {{!-- Basic Information Section --}}
        <div class="basic-info-section" style="display: block;">
          <h3 style="text-align: center; margin-bottom: 15px;">Basic Information</h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 500px; margin: 0 auto;">
            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Item Type</label>
              <select name="system.itemType" class="itemtype-selector" style="text-align: center; width: 100%;">
                <optgroup label="Equipment">
                  <option value="body" {{#if (eq system.itemType "body")}}selected{{/if}}>Body Armor</option>
                  <option value="headwear" {{#if (eq system.itemType "headwear")}}selected{{/if}}>Headwear</option>
                  <option value="gloves" {{#if (eq system.itemType "gloves")}}selected{{/if}}>Gloves</option>
                  <option value="boots" {{#if (eq system.itemType "boots")}}selected{{/if}}>Boots</option>
                  <option value="accessory" {{#if (eq system.itemType "accessory")}}selected{{/if}}>Accessory</option>
                  <option value="cloak" {{#if (eq system.itemType "cloak")}}selected{{/if}}>Cloak</option>
                  <option value="shield" {{#if (eq system.itemType "shield")}}selected{{/if}}>Shield</option>
                </optgroup>
                <optgroup label="Weapons">
                  <option value="weapon" {{#if (eq system.itemType "weapon")}}selected{{/if}}>Weapon</option>
                </optgroup>
                <optgroup label="General Items">
                  <option value="tool" {{#if (eq system.itemType "tool")}}selected{{/if}}>Tool</option>
                  <option value="consumable" {{#if (eq system.itemType "consumable")}}selected{{/if}}>Consumable</option>
                  <option value="crafting" {{#if (eq system.itemType "crafting")}}selected{{/if}}>Crafting Material</option>
                  <option value="treasure" {{#if (eq system.itemType "treasure")}}selected{{/if}}>Treasure</option>
                  <option value="implant" {{#if (eq system.itemType "implant")}}selected{{/if}}>Implant</option>
                  <option value="misc" {{#if (eq system.itemType "misc")}}selected{{/if}}>Miscellaneous</option>
                </optgroup>
              </select>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Rarity</label>
              <select name="system.rarity" style="text-align: center; width: 100%;">
                <option value="common" {{#if (eq system.rarity "common")}}selected{{/if}}>Common</option>
                <option value="uncommon" {{#if (eq system.rarity "uncommon")}}selected{{/if}}>Uncommon</option>
                <option value="rare" {{#if (eq system.rarity "rare")}}selected{{/if}}>Rare</option>
                <option value="very_rare" {{#if (eq system.rarity "very_rare")}}selected{{/if}}>Very Rare</option>
                <option value="legendary" {{#if (eq system.rarity "legendary")}}selected{{/if}}>Legendary</option>
                <option value="artifact" {{#if (eq system.rarity "artifact")}}selected{{/if}}>Artifact</option>
              </select>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Weight (bulk)</label>
              <input type="number" name="system.weight" value="{{system.weight}}" step="0.1" placeholder="0" style="text-align: center; width: 100%;"/>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Value (silver)</label>
              <input type="number" name="system.value" value="{{system.value}}" placeholder="0" style="text-align: center; width: 100%;"/>
            </div>
          </div>
        </div>

        {{!-- Description Section --}}
        <div class="description-section" style="display: block; margin-top: 20px;">
          <h3 style="text-align: center; margin-bottom: 15px;">Description</h3>
          <div style="max-width: 600px; margin: 0 auto;">
            {{editor system.description target="system.description" button=true owner=owner editable=editable}}
          </div>
        </div>

        {{!-- Type-Specific Basic Properties --}}
        {{#if (eq system.itemType "consumable")}}
        <div class="consumable-basic-section">
          <h3>Consumable Properties</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Consumable Category</label>
              <select name="system.consumable_category">
                <option value="potion" {{#if (eq system.consumable_category "potion")}}selected{{/if}}>Potion</option>
                <option value="food" {{#if (eq system.consumable_category "food")}}selected{{/if}}>Food</option>
                <option value="poison" {{#if (eq system.consumable_category "poison")}}selected{{/if}}>Poison</option>
                <option value="scroll" {{#if (eq system.consumable_category "scroll")}}selected{{/if}}>Scroll</option>
                <option value="bomb" {{#if (eq system.consumable_category "bomb")}}selected{{/if}}>Bomb</option>
                <option value="ammunition" {{#if (eq system.consumable_category "ammunition")}}selected{{/if}}>Ammunition</option>
                <option value="other" {{#if (eq system.consumable_category "other")}}selected{{/if}}>Other</option>
              </select>
            </div>
          </div>
        </div>
        {{/if}}

        {{!-- Shield Properties (only for shields) --}}
        {{#if (eq system.itemType "shield")}}
        <div class="shield-basic-section" style="display: block; margin-top: 20px;">
          <h3 style="text-align: center; margin-bottom: 15px;">Shield Properties</h3>
          <div style="max-width: 500px; margin: 0 auto;">
            <div class="form-grid">
              <div class="form-group">
                <label>Shield Category</label>
                <select name="system.shield_category" style="width: 100%;">
                  <option value="" {{#unless system.shield_category}}selected{{/unless}}>Not a Shield</option>
                  <option value="light" {{#if (eq system.shield_category "light")}}selected{{/if}}>Light Shield</option>
                  <option value="heavy" {{#if (eq system.shield_category "heavy")}}selected{{/if}}>Heavy Shield</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        {{/if}}

        {{!-- Encumbrance Penalty (for equipment, shields, and weapons) --}}
        {{#if (or (eq system.itemType "body") (eq system.itemType "headwear") (eq system.itemType "gloves") (eq system.itemType "boots") (eq system.itemType "accessory") (eq system.itemType "cloak") (eq system.itemType "shield") (eq system.itemType "weapon"))}}
        <div class="encumbrance-section" style="display: block; margin-top: 20px;">
          <h3 style="text-align: center; margin-bottom: 15px;">Encumbrance</h3>
          <div style="max-width: 500px; margin: 0 auto;">
            <div class="form-group">
              <label>Encumbrance Penalty</label>
              <input type="number" name="system.encumbrance_penalty" value="{{system.encumbrance_penalty}}" placeholder="0" style="width: 100%;"/>
              <small>Movement penalty when worn/equipped</small>
            </div>
          </div>
        </div>
        {{/if}}

      </div>
    </div>

    {{!-- Weapon Tab (for weapon items) --}}
    {{#if (eq system.itemType "weapon")}}
    <div class="tab" data-group="primary" data-tab="weapon">
      <div class="weapon-properties">

        {{!-- Weapon Properties --}}
        <div class="weapon-basic-section" style="display: block;">
          <h3 style="text-align: center; margin-bottom: 15px;">Weapon Properties</h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 500px; margin: 0 auto;">
            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Weapon Category</label>
              <select name="system.weapon_category" style="text-align: center; width: 100%;">
                <option value="brawling" {{#if (eq system.weapon_category "brawling")}}selected{{/if}}>Brawling</option>
                <option value="throwing" {{#if (eq system.weapon_category "throwing")}}selected{{/if}}>Throwing</option>
                <option value="simpleMeleeWeapons" {{#if (eq system.weapon_category "simpleMeleeWeapons")}}selected{{/if}}>Simple Melee</option>
                <option value="simpleRangedWeapons" {{#if (eq system.weapon_category "simpleRangedWeapons")}}selected{{/if}}>Simple Ranged</option>
                <option value="complexMeleeWeapons" {{#if (eq system.weapon_category "complexMeleeWeapons")}}selected{{/if}}>Complex Melee</option>
                <option value="complexRangedWeapons" {{#if (eq system.weapon_category "complexRangedWeapons")}}selected{{/if}}>Complex Ranged</option>
              </select>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Hands Required</label>
              <select name="system.hands" style="text-align: center; width: 100%;">
                <option value="1" {{#if (eq system.hands 1)}}selected{{/if}}>One-Handed</option>
                <option value="2" {{#if (eq system.hands 2)}}selected{{/if}}>Two-Handed</option>
              </select>
            </div>

            {{#if (eq system.weapon_category "throwing")}}
            <div style="display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 5px; font-weight: bold;">Stack Limit</label>
              <input type="number" name="system.stack_limit" value="{{system.stack_limit}}" placeholder="0" style="text-align: center; width: 100%;" title="0 = no limit"/>
            </div>
            {{/if}}
          </div>
        </div>

        {{!-- Primary Attack --}}
        <div class="attack-section">
          <h3>Primary Attack</h3>
          <div class="weapon-attack-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            {{!-- Row 1: Attack Category, Energy, Range --}}
            <div class="form-group">
              <label>Attack Category</label>
              <select name="system.primary.category">
                <option value="slash" {{#if (eq system.primary.category "slash")}}selected{{/if}}>Slash</option>
                <option value="thrust" {{#if (eq system.primary.category "thrust")}}selected{{/if}}>Thrust</option>
                <option value="blunt" {{#if (eq system.primary.category "blunt")}}selected{{/if}}>Blunt</option>
                <option value="ranged" {{#if (eq system.primary.category "ranged")}}selected{{/if}}>Ranged</option>
                <option value="black" {{#if (eq system.primary.category "black")}}selected{{/if}}>Black Magic</option>
                <option value="primal" {{#if (eq system.primary.category "primal")}}selected{{/if}}>Primal Magic</option>
                <option value="meta" {{#if (eq system.primary.category "meta")}}selected{{/if}}>Meta Magic</option>
                <option value="white" {{#if (eq system.primary.category "white")}}selected{{/if}}>White Magic</option>
                <option value="mysticism" {{#if (eq system.primary.category "mysticism")}}selected{{/if}}>Mysticism Magic</option>
                <option value="arcane" {{#if (eq system.primary.category "arcane")}}selected{{/if}}>Arcane Magic</option>
              </select>
            </div>
            <div class="form-group">
              <label>Energy</label>
              <input type="number" name="system.primary.energy" value="{{system.primary.energy}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/range-select.hbs"
                minName="system.primary.min_range"
                maxName="system.primary.max_range"
                minValue=system.primary.min_range
                maxValue=system.primary.max_range
                label="Range"
                mode="dual"}}

            {{!-- Row 2: Damage, Extra Damage, Damage Type --}}
            <div class="form-group">
              <label>Damage</label>
              <input type="number" name="system.primary.damage" value="{{system.primary.damage}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Extra Damage</label>
              <input type="number" name="system.primary.damage_extra" value="{{system.primary.damage_extra}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/damage-type-select.hbs"
                name="system.primary.damage_type"
                value=system.primary.damage_type}}

            {{!-- Row 3: Secondary Damage Header (spans all 3 columns) --}}
            <div style="grid-column: 1 / -1; margin-top: 10px;">
              <h4 style="margin: 0; font-size: 0.9em; opacity: 0.8;">Secondary Damage</h4>
            </div>

            {{!-- Row 4: Secondary Damage, Secondary Extra, Secondary Type --}}
            <div class="form-group">
              <label>Damage</label>
              <input type="number" name="system.primary.secondary_damage" value="{{system.primary.secondary_damage}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Extra Damage</label>
              <input type="number" name="system.primary.secondary_damage_extra" value="{{system.primary.secondary_damage_extra}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/damage-type-select.hbs"
                name="system.primary.secondary_damage_type"
                value=system.primary.secondary_damage_type
                includeNone=true}}
          </div>
        </div>

        {{!-- Secondary Attack (if two-handed or special weapons) --}}
        <div class="secondary-attack-section">
          <h3>Secondary Attack (Optional)</h3>
          <div class="weapon-attack-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            {{!-- Row 1: Attack Category, Energy, Range --}}
            <div class="form-group">
              <label>Attack Category</label>
              <select name="system.secondary.category">
                <option value="slash" {{#if (eq system.secondary.category "slash")}}selected{{/if}}>Slash</option>
                <option value="thrust" {{#if (eq system.secondary.category "thrust")}}selected{{/if}}>Thrust</option>
                <option value="blunt" {{#if (eq system.secondary.category "blunt")}}selected{{/if}}>Blunt</option>
                <option value="ranged" {{#if (eq system.secondary.category "ranged")}}selected{{/if}}>Ranged</option>
                <option value="black" {{#if (eq system.secondary.category "black")}}selected{{/if}}>Black Magic</option>
                <option value="primal" {{#if (eq system.secondary.category "primal")}}selected{{/if}}>Primal Magic</option>
                <option value="meta" {{#if (eq system.secondary.category "meta")}}selected{{/if}}>Meta Magic</option>
                <option value="white" {{#if (eq system.secondary.category "white")}}selected{{/if}}>White Magic</option>
                <option value="mysticism" {{#if (eq system.secondary.category "mysticism")}}selected{{/if}}>Mysticism Magic</option>
                <option value="arcane" {{#if (eq system.secondary.category "arcane")}}selected{{/if}}>Arcane Magic</option>
              </select>
            </div>
            <div class="form-group">
              <label>Energy</label>
              <input type="number" name="system.secondary.energy" value="{{system.secondary.energy}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/range-select.hbs"
                minName="system.secondary.min_range"
                maxName="system.secondary.max_range"
                minValue=system.secondary.min_range
                maxValue=system.secondary.max_range
                label="Range"
                mode="dual"}}

            {{!-- Row 2: Damage, Extra Damage, Damage Type --}}
            <div class="form-group">
              <label>Damage</label>
              <input type="number" name="system.secondary.damage" value="{{system.secondary.damage}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Extra Damage</label>
              <input type="number" name="system.secondary.damage_extra" value="{{system.secondary.damage_extra}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/damage-type-select.hbs"
                name="system.secondary.damage_type"
                value=system.secondary.damage_type}}

            {{!-- Row 3: Secondary Damage Header (spans all 3 columns) --}}
            <div style="grid-column: 1 / -1; margin-top: 10px;">
              <h4 style="margin: 0; font-size: 0.9em; opacity: 0.8;">Secondary Damage</h4>
            </div>

            {{!-- Row 4: Secondary Damage, Secondary Extra, Secondary Type --}}
            <div class="form-group">
              <label>Damage</label>
              <input type="number" name="system.secondary.secondary_damage" value="{{system.secondary.secondary_damage}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Extra Damage</label>
              <input type="number" name="system.secondary.secondary_damage_extra" value="{{system.secondary.secondary_damage_extra}}" placeholder="0"/>
            </div>
            {{> "systems/anyventure/templates/partials/dropdowns/damage-type-select.hbs"
                name="system.secondary.secondary_damage_type"
                value=system.secondary.secondary_damage_type
                includeNone=true}}
          </div>
        </div>

      </div>
    </div>
    {{/if}}

    {{!-- Implant Tab --}}
    {{#if (eq system.itemType "implant")}}
    <div class="tab" data-group="primary" data-tab="implant">
      <div class="implant-properties">

        <div class="implant-section">
          <h3>Implant Properties</h3>
          <div class="form-grid">
            {{> "systems/anyventure/templates/partials/dropdowns/implant-type-select.hbs"
                name="system.implant_data.implant_type"
                value=system.implant_data.implant_type}}

            <div class="form-group">
              <label>Pain Penalty</label>
              <input type="number" name="system.implant_data.pain_penalty" value="{{system.implant_data.pain_penalty}}" min="0" step="1"/>
            </div>

            <div class="form-group">
              <label>Health Penalty</label>
              <input type="number" name="system.implant_data.health_penalty" value="{{system.implant_data.health_penalty}}" min="0" step="1"/>
            </div>

            <div class="form-group">
              <label>Resolve Penalty</label>
              <input type="number" name="system.implant_data.resolve_penalty" value="{{system.implant_data.resolve_penalty}}" min="0" step="1"/>
            </div>

            <div class="form-group">
              <label>Rejection Check DC (0 = no check)</label>
              <input type="number" name="system.implant_data.rejection_check" value="{{system.implant_data.rejection_check}}" min="0" step="1"/>
            </div>
          </div>
        </div>

      </div>
    </div>
    {{/if}}

    {{!-- Bonuses Tab --}}
    <div class="tab" data-group="primary" data-tab="bonuses">
      <div class="bonuses-content">
        {{> "systems/anyventure/templates/partials/items/resource-bonuses.hbs"}}
        {{> "systems/anyventure/templates/partials/items/skill-bonuses.hbs"}}
      </div>
    </div>

    {{!-- Mitigation Tab --}}
    <div class="tab" data-group="primary" data-tab="mitigation">
      <div class="mitigation-content">

        <div class="mitigation-section">
          <h3>Damage Mitigation</h3>
          <div class="mitigation-grid">
            <div class="form-group">
              <label>Physical</label>
              <input type="number" name="system.mitigation.physical" value="{{system.mitigation.physical}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Heat</label>
              <input type="number" name="system.mitigation.heat" value="{{system.mitigation.heat}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Cold</label>
              <input type="number" name="system.mitigation.cold" value="{{system.mitigation.cold}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Lightning</label>
              <input type="number" name="system.mitigation.lightning" value="{{system.mitigation.lightning}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Dark</label>
              <input type="number" name="system.mitigation.dark" value="{{system.mitigation.dark}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Divine</label>
              <input type="number" name="system.mitigation.divine" value="{{system.mitigation.divine}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Arcane</label>
              <input type="number" name="system.mitigation.arcane" value="{{system.mitigation.arcane}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Psychic</label>
              <input type="number" name="system.mitigation.psychic" value="{{system.mitigation.psychic}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Toxic</label>
              <input type="number" name="system.mitigation.toxic" value="{{system.mitigation.toxic}}" placeholder="0"/>
            </div>
          </div>
        </div>

        <div class="detection-section">
          <h3>Detection & Awareness</h3>
          <div class="detection-grid">
            <div class="form-group">
              <label>Tremorsense</label>
              <input type="number" name="system.detections.tremorsense" value="{{system.detections.tremorsense}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Darkvision</label>
              <input type="number" name="system.detections.darkvision" value="{{system.detections.darkvision}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Blindsight</label>
              <input type="number" name="system.detections.blindsight" value="{{system.detections.blindsight}}" placeholder="0"/>
            </div>
            <div class="form-group">
              <label>Truesight</label>
              <input type="number" name="system.detections.truesight" value="{{system.detections.truesight}}" placeholder="0"/>
            </div>
          </div>
        </div>

        <div class="immunities-section">
          <h3>Immunities & Resistances</h3>
          <div class="immunities-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.blind" {{#if system.immunities.blind}}checked{{/if}}/>
              <span>Blind</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.charmed" {{#if system.immunities.charmed}}checked{{/if}}/>
              <span>Charmed</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.deafened" {{#if system.immunities.deafened}}checked{{/if}}/>
              <span>Deafened</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.frightened" {{#if system.immunities.frightened}}checked{{/if}}/>
              <span>Frightened</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.paralyzed" {{#if system.immunities.paralyzed}}checked{{/if}}/>
              <span>Paralyzed</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.poisoned" {{#if system.immunities.poisoned}}checked{{/if}}/>
              <span>Poisoned</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="system.immunities.stunned" {{#if system.immunities.stunned}}checked{{/if}}/>
              <span>Stunned</span>
            </label>
          </div>
        </div>

      </div>
    </div>

  </section>
</form>
