<form class="{{cssClass}} {{actor.type}}" autocomplete="off">
  <div class="sheet-wrapper">
    
    {{!-- Left Sidebar - Always Visible --}}
    <aside class="left-sidebar">
      {{!-- Character Header --}}
      <div class="character-header">
        <div class="character-portrait-row">
          <img class="wonder-token {{#unless system.wonder}}inactive{{/unless}}" src="systems/anyventure/artwork/icons/ui/wonder.png" title="Wonder Token" data-action="toggle-wonder"/>
          <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
          <img class="woe-token {{#unless system.woe}}inactive{{/unless}}" src="systems/anyventure/artwork/icons/ui/woe.png" title="Woe Token" data-action="toggle-woe"/>
        </div>
        <h1 class="charname">
          <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
        </h1>

        {{!-- Character Utilities removed from header --}}
      </div>

      {{!-- Resources Section --}}
      <div class="resources-section">
        <div class="resource-group">
          <div class="resource-quick-actions" title="Resource Actions">
            <button type="button" class="resource-btn quick-action-btn" data-action="recover" title="Recover Resources">
              <i class="fas fa-heart"></i>
            </button>
            <button type="button" class="resource-btn quick-action-btn" data-action="damage" title="Take Damage">
              <i class="fas fa-heart-broken"></i>
            </button>
            <button type="button" class="resource-btn quick-action-btn" data-action="start-turn" title="Start Turn">
              <i class="fas fa-hourglass-start"></i>
            </button>
            <button type="button" class="resource-btn quick-action-btn" data-action="rest" title="Take Rest">
              <i class="fas fa-bed"></i>
            </button>
            <button type="button" class="resource-btn quick-action-btn" data-action="fall-unconscious" title="Fall Unconscious">
              <i class="fas fa-user-injured"></i>
            </button>
          </div>
          <div class="resource-bar health">
            <label>Health</label>
            <div class="resource-controls">
              <button type="button" class="resource-btn minus" data-resource="health" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <div class="resource-values">
                <input type="number" name="system.resources.health.value" value="{{system.resources.health.value}}"/>
                <span class="separator">/</span>
                <input type="number" name="system.resources.health.max" value="{{system.resources.health.max}}"/>
              </div>
              <button type="button" class="resource-btn plus" data-resource="health" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="resource-fill" style="width: {{percentage system.resources.health.value system.resources.health.max}}%"></div>
          </div>
          <div class="resource-bar resolve">
            <label>Resolve</label>
            <div class="resource-controls">
              <button type="button" class="resource-btn minus" data-resource="resolve" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <div class="resource-values">
                <input type="number" name="system.resources.resolve.value" value="{{system.resources.resolve.value}}"/>
                <span class="separator">/</span>
                <input type="number" name="system.resources.resolve.max" value="{{system.resources.resolve.max}}"/>
              </div>
              <button type="button" class="resource-btn plus" data-resource="resolve" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="resource-fill" style="width: {{percentage system.resources.resolve.value system.resources.resolve.max}}%"></div>
          </div>
          <div class="resource-bar morale">
            <label>Morale</label>
            <div class="resource-controls">
              <button type="button" class="resource-btn minus" data-resource="morale" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <div class="resource-values">
                <input type="number" name="system.resources.morale.value" value="{{system.resources.morale.value}}"/>
                <span class="separator">/</span>
                <input type="number" name="system.resources.morale.max" value="{{system.resources.morale.max}}"/>
              </div>
              <button type="button" class="resource-btn plus" data-resource="morale" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="resource-fill" style="width: {{percentage system.resources.morale.value system.resources.morale.max}}%"></div>
          </div>
          <div class="resource-bar energy">
            <label>Energy</label>
            <div class="resource-controls">
              <button type="button" class="resource-btn minus" data-resource="energy" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <div class="resource-values">
                <input type="number" name="system.resources.energy.value" value="{{system.resources.energy.value}}"/>
                <span class="separator">/</span>
                <input type="number" name="system.resources.energy.max" value="{{system.resources.energy.max}}"/>
              </div>
              <button type="button" class="resource-btn plus" data-resource="energy" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="resource-fill" style="width: {{percentage system.resources.energy.value system.resources.energy.max}}%"></div>
          </div>
          {{#if (gt system.resources.mana.max 0)}}
          <div class="resource-bar mana">
            <label>Mana</label>
            <div class="resource-controls">
              <button type="button" class="resource-btn minus" data-resource="mana" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <div class="resource-values">
                <input type="number" name="system.resources.mana.value" value="{{system.resources.mana.value}}"/>
                <span class="separator">/</span>
                <input type="number" name="system.resources.mana.max" value="{{system.resources.mana.max}}"/>
              </div>
              <button type="button" class="resource-btn plus" data-resource="mana" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="resource-fill" style="width: {{percentage system.resources.mana.value system.resources.mana.max}}%"></div>
          </div>
          {{/if}}
        </div>
      </div>

      {{!-- Mitigations Section --}}
      {{> "systems/anyventure/templates/partials/mitigations.hbs"}}

      {{!-- Movement Section --}}
      {{> "systems/anyventure/templates/partials/movement.hbs"}}

      {{!-- Encumbrance Penalty Section --}}
      <div class="encumbrance-container" style="text-align: center; margin-top: 10px;">
        <div class="encumbrance-display">
          <i class="fas fa-weight-hanging"></i>
          <span class="encumbrance-label">Encumbrance Penalty:</span>
          <span class="encumbrance-value">{{system.encumbrance_penalty}}</span>
        </div>
      </div>
    </aside>

    {{!-- Main Content Area --}}
    <main class="main-content">
      {{!-- Tab Navigation --}}
      <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item active" data-tab="skills">Skills</a>
        <a class="item" data-tab="character">Character</a>
        <a class="item" data-tab="moves">Moves</a>
        <a class="item" data-tab="equipment">Equipment</a>
        <a class="item" data-tab="spells">Spells</a>
        <a class="item" data-tab="songs">Songs</a>
        <a class="item" data-tab="biography">Biography</a>
      </nav>
      
      {{!-- Sheet Body for Tab Content --}}
      <section class="sheet-body">
        {{!-- Skills Tab --}}
        <div class="tab skills active" data-group="primary" data-tab="skills">
          {{> "systems/anyventure/templates/partials/skills.hbs"}}
        </div>

        {{!-- Character Tab --}}
        <div class="tab character" data-group="primary" data-tab="character">
          {{> "systems/anyventure/templates/partials/modules.hbs"}}
        </div>

        {{!-- Moves Tab --}}
        <div class="tab moves" data-group="primary" data-tab="moves">
          {{> "systems/anyventure/templates/partials/moves.hbs"}}
        </div>

        {{!-- Equipment Tab --}}
        <div class="tab equipment" data-group="primary" data-tab="equipment">
          {{> "systems/anyventure/templates/partials/equipment.hbs"}}
        </div>

        {{!-- Spells Tab --}}
        <div class="tab spells" data-group="primary" data-tab="spells">
          {{> "systems/anyventure/templates/partials/spells.hbs"}}
        </div>

        {{!-- Songs Tab --}}
        <div class="tab songs" data-group="primary" data-tab="songs">
          {{> "systems/anyventure/templates/partials/songs.hbs"}}
        </div>

        {{!-- Biography Tab --}}
        <div class="tab biography" data-group="primary" data-tab="biography">
          {{> "systems/anyventure/templates/partials/biography.hbs"}}
        </div>
      </section>
    </main>
  </div>
</form>
